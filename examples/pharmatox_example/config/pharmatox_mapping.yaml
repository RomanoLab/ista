# PharmaTox Knowledge Graph Mapping Configuration
#
# This is a TOY EXAMPLE using SYNTHETIC DATA for testing and demonstration
# purposes only. The mappings define how to populate an ontology from
# multiple data sources (CSV, TSV, SQLite).

version: "1.0"
base_iri: "http://example.org/pharmatox#"

# Named transforms for data value processing
transforms:
  trim_whitespace:
    type: trim

  normalize_cas:
    type: chain
    steps:
      - { type: trim }
      - { type: strip_prefix, params: { value: "CAS-" } }

  to_lowercase:
    type: lowercase

# Data source definitions
sources:
  drugs_csv:
    type: csv
    path: "./data/drugs.csv"
    delimiter: ","
    has_headers: true

  drug_toxicity_csv:
    type: csv
    path: "./data/drug_toxicity.csv"
    delimiter: ","
    has_headers: true

  genes_tsv:
    type: tsv
    path: "./data/genes.tsv"
    has_headers: true

  diseases_tsv:
    type: tsv
    path: "./data/diseases.tsv"
    has_headers: true

  pathways_tsv:
    type: tsv
    path: "./data/pathways.tsv"
    has_headers: true

  pharmatox_db:
    type: sqlite
    path: "./data/pharmatox.db"

# Entity type definitions with primary source and optional enrichments
entity_types:
  Drug:
    primary:
      source: drugs_csv
      iri_column: drugbank_id
      properties:
        - { column: drugbank_id, property: xrefDrugbank }
        - { column: common_name, property: commonName }
        - { column: cas_number, property: xrefCasRN }
        - { column: pubchem_cid, property: xrefPubchemCID }
    enrichments:
      - name: "Drug Toxicity Data"
        source: drug_toxicity_csv
        match:
          source_column: cas_number
          target_property: xrefCasRN
        properties:
          - { column: ld50_value, property: ld50Value, datatype: float }
          - { column: ld50_units, property: ld50Units }

  Gene:
    primary:
      source: genes_tsv
      iri_column: gene_symbol
      properties:
        - { column: ncbi_gene_id, property: xrefNcbiGene, datatype: integer }
        - { column: gene_symbol, property: geneSymbol }
        - { column: common_name, property: commonName }

  Disease:
    primary:
      source: diseases_tsv
      iri_column: umls_cui
      properties:
        - { column: umls_cui, property: xrefUmlsCUI }
        - { column: mesh_id, property: xrefMeSH }
        - { column: common_name, property: commonName }

  Pathway:
    primary:
      source: pathways_tsv
      iri_column: reactome_id
      properties:
        - { column: reactome_id, property: xrefReactome }
        - { column: pathway_name, property: commonName }

# Node mappings for entities from database and derived entities
node_mappings:
  - name: "DrugClass from CSV"
    source: drugs_csv
    target_class: DrugClass
    mode: create
    iri_column: drug_class
    properties:
      - { column: drug_class, property: commonName }

  - name: "AdverseEvents from SQLite"
    source: pharmatox_db
    target_class: AdverseEvent
    mode: create
    table: adverse_events
    iri_column: meddra_id
    properties:
      - { column: meddra_id, property: xrefMeddra }
      - { column: event_name, property: commonName }
      - { column: severity, property: severity }

  - name: "CellTypes from SQLite"
    source: pharmatox_db
    target_class: CellType
    mode: create
    table: cell_types
    iri_column: cl_id
    properties:
      - { column: cl_id, property: xrefCL }
      - { column: cell_name, property: commonName }

# Relationship mappings connecting entities
relationship_mappings:
  - name: "Drug In Class"
    source: drugs_csv
    relationship: drugInClass
    subject:
      class_name: Drug
      column: drugbank_id
      match_property: xrefDrugbank
    object:
      class_name: DrugClass
      column: drug_class
      match_property: commonName

  - name: "Drug Treats Disease"
    source: pharmatox_db
    table: drug_treats_disease
    relationship: drugTreatsDisease
    subject:
      class_name: Drug
      column: drugbank_id
      match_property: xrefDrugbank
    object:
      class_name: Disease
      column: umls_cui
      match_property: xrefUmlsCUI

  - name: "Drug Targets Gene"
    source: pharmatox_db
    table: drug_targets_gene
    relationship: drugTargetsGene
    subject:
      class_name: Drug
      column: drugbank_id
      match_property: xrefDrugbank
    object:
      class_name: Gene
      column: ncbi_gene_id
      match_property: xrefNcbiGene

  - name: "Gene Associates With Disease"
    source: pharmatox_db
    table: gene_disease_association
    relationship: geneAssociatesWithDisease
    subject:
      class_name: Gene
      column: ncbi_gene_id
      match_property: xrefNcbiGene
    object:
      class_name: Disease
      column: umls_cui
      match_property: xrefUmlsCUI

  - name: "Gene In Pathway"
    source: pharmatox_db
    table: gene_pathway
    relationship: geneInPathway
    subject:
      class_name: Gene
      column: ncbi_gene_id
      match_property: xrefNcbiGene
    object:
      class_name: Pathway
      column: reactome_id
      match_property: xrefReactome

  - name: "Drug Causes Adverse Event"
    source: pharmatox_db
    table: drug_adverse_event
    relationship: drugCausesAdverseEvent
    subject:
      class_name: Drug
      column: drugbank_id
      match_property: xrefDrugbank
    object:
      class_name: AdverseEvent
      column: meddra_id
      match_property: xrefMeddra

  - name: "Gene Expressed In CellType"
    source: pharmatox_db
    table: gene_expression
    relationship: geneExpressedInCellType
    subject:
      class_name: Gene
      column: ncbi_gene_id
      match_property: xrefNcbiGene
    object:
      class_name: CellType
      column: cl_id
      match_property: xrefCL
